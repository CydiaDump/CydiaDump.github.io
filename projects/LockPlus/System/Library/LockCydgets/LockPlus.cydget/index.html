<html>
<head>
  <title></title>
  <meta name="viewport" content="width=device-width, height=device-height initial-scale=1">
  <meta charset="UTF-8">
<style>
body{
  padding: 0;
  margin: 0;
  font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif;
  font-weight: 200;
}
p{
  margin: 0;
  padding: 0;
}
.bgSwipe, .container, .screenOverlay{
  position: absolute;
  width: 320px;
  height: 568px;
}
.container, .screenOverlay{
  overflow: hidden;
  background-repeat: no-repeat;
  background-size: cover;
  -webkit-background-clip: padding-box;
}
.screenOverlay{
  pointer-events:none;
}
.detectSwipe{
  position: absolute;
  width: 150px;
  height: 568px;
  right:0;
}
.menuScreen{
  position: absolute;
  width: 60px;
  height: 320px;
  background-color: #54606e;
  top: 20%;
  right:0;
  border-top-left-radius: 5px;
  border-bottom-left-radius: 5px;
  display: none;
  z-index: 9;
}
.menuScreen div{
  position: relative;
  top: 15px;
  margin-top: -30px;
}
.menuScreen img, .download{
  -webkit-transform:scale(0.6);
  margin-top: 3px;
  margin-left: -10px;
  pointer-events:none;
}
.download{
  margin-left: -15px;
}
.themeList{
  position: absolute;
  width: 130px;
  height: 230px;
  top: 50%;
  left: 50%;
  -webkit-transform: translateX(-50%)translateY(-50%)scale(1.6);
  background-repeat: no-repeat;
  background-size: cover;
  -webkit-background-clip: padding-box;
  overflow: hidden;
  display: none;
  z-index: 999;
  border-radius: 5px;
  background-color: black;
}
.themeName, .themeCount{
  position: absolute;
  color: white;
  width: 100%;
  font-size: 5px;
  padding-top:2px;
}
.themeName{
  top:0;
  text-align: left;
  padding-left:3px;
  background-color: rgba(0,0,0,0.7);
}
.themeCount{
  top:0;
  right:3px;
  text-align: right;
}
#screenElements div{
  position: absolute;
  color:white;
  font-size: 30px;
  white-space: nowrap;
  z-index: 1;
  width: auto;
  text-align: left;
}
.darkbg{
  position: absolute;
  width: 320px;
  height: 568px;
  background-color: rgba(0,0,0,0.7);
  display: none;
  pointer-events:none;
  z-index: 2;
}
.instruct{
  position: absolute;
  color: white;
  width: 320px;
  bottom:25px;
  text-align: center;
}
.psmall{
  font-size: 10px;
  opacity: 0.8;
}
.svg{opacity: 0;}
#trash{
  -webkit-transform:scale(0.8);
  position: absolute;
  top:27px;
  left:146px;
  z-index: 999;
}
#favorite{
  -webkit-transform:scale(0.8);
  position: absolute;
  top:61px;
  left:139px;
  z-index: 999;
}
/* View Themes */
#frame{
  width: 320px;
  height: 568px;
  overflow: scroll;
  position: absolute;
  z-index: 999;
  display: none;
  -webkit-overflow-scrolling: touch;
  background-color: white;

}
/*#frame img{
  width: 100px;
  margin-left: 5px;
  margin-top:5px;
  display: inline;
}*/
.themeContainer{
  margin-left: 5px;
  margin-top:5px;
  background-color:tranparent;
  width:100px;
  height:180px;
  display:inline-block;
}
.themeimg{
  width:100px;
  display:inline;
  position:relative;
}
.themebadge{
  position:absolute;
  margin-left:71px;
  margin-top:-1;
  text-align:center;
  width:30px;
  z-index:9;
}
#loaderGif{
  position: absolute;
  left: 106px;
  top:255px;
  z-index: 99999;
  background-color: rgba(0,0,0,0.1);
  padding: 10px;
  border-radius: 999px;
  display: none;
}
#view:after{
  position: absolute;
  top:14;
  right:2px;
  width: 20px;
  height: 10px;
  text-align: center;
  content: attr(title);
  color:white;
  font-size: 8px;
  line-height: 14px;
}
#themeListGif{
  position: absolute;
  top:10px;
  left:50px;
  z-index: 2;
}
.buttons{
  position:relative;left:5px;top:20px;width:310px;height:50px;
}
.pagesCount{
  position:absolute;
  right:130px;
  top:4px;
  display:inline;
  font-size:10px;
  pointer-events:none;
  text-align:center;
  width:40px;
  height:12px;
  padding:5px;
  background-color:rgba(0,0,0,0.1);
  color:#54606e;
  border-radius:2px;
}
.nextButton, .prevButton{
  position:absolute;
  width:50px;
  height:30px;
  color:#54606e;
  text-align:center;
  line-height:30px;
  background-color:rgba(0,0,0,0.1);
  border-radius:2px;
  display: inline;
}
.nextButton{
  right:60px;
}
.prevButton{
  left:60px;
}
#canvasRain,#canvasCloud,#canvasStar{
  pointer-events:none;
}
#canvasRain{
  position: absolute;
  top: 0;
  left: 0;
  z-index: 1;
}
#canvasCloud{
  position: absolute;
  top: 0;
  left: 0;
  opacity: 0.3;
  z-index: 1;
}
#canvasStar{
  position: absolute;
  top: 0;
  left: 0;
  opacity: 0.8;
  z-index: 1;
/*      background: -webkit-gradient(linear, left top, left bottom, color-stop(0%,rgba(0,0,0,0.7)), color-stop(100%,rgba(255,255,255,0))); */
}
#birds{
  position: absolute;
  left: 0;
  top:0;
  pointer-events:none;
}
</style>
</head>
<body>
  <canvas id="canvasRain" width="320" height="600"></canvas>
  <canvas id="canvasCloud" width="320" height="600"></canvas>
  <canvas id="canvasStar" width="320" height="200"></canvas>
  <div id="frame"></div>
  <div id="loaderGif">Downloading</div>
  <div id="instruct" style="position:absolute;top:0;display:none;z-index:999;" class="instruct" ><img id="instimg" src="svg/info/1.svg" style="pointer-events:none;"/></div>
  <div class="container">
    <div class="bgSwipe"></div>
    <div class="detectSwipe"></div>
    <div class="menuScreen">
      <div id="load"><img src="svg/load.svg"/></div>
      <div id="reset"><img src="svg/reset.svg"/></div>
      <div id="refresh"><img src="svg/refresh.svg"/></div>
      <div id="settings"><img src="svg/settings.svg"/></div>
      <div id="download"><img class="download" src="svg/download.svg"/></div>
      <div id="view" title=""><img src="svg/view.svg"/><img id="themeListGif" src="svg/loader.gif" width="15"/></div>
    </div>
    <div id="screenElements">
    </div>
    <div class="darkbg">
      <div class="instruct">
        <p>-Swipe Image-</p>
        <p class="psmall">Down to close</p>
        <p class="psmall">Up to load</p>
        <p class="psmall">Left/Right for themes</p>
      </div>
    </div>
    <div class="themeList">
      <p class="themeName">test</p>
      <p class="themeCount"></p>
    </div>
  </div>
  <div id="trash" style="display:none;" onclick="deleteit()"><img src="svg/trash.svg"/></div>
  <div id="favorite" style="display:none;opacity:0.2;" onclick="favit()"><img src="svg/fav.svg"/></div>
  <div class="screenOverlay"></div>
  <img class='svg' style="display:none; opacity:0;"/>
<script type="text/cycript">

function setNotify(state){
 var plist = [NSMutableDictionary dictionaryWithContentsOfFile:@"/System/Library/LockCydgets/LockPlus.cydget/Info.plist"];
     [[plist valueForKey:@'CYConfiguration'] setObject:@""+state forKey:@"NotificationList"];
     [plist writeToFile:@"/System/Library/LockCydgets/LockPlus.cydget/Info.plist" atomically:YES];
 var okToRespring = confirm('The notification setting requires a respring, respring now?');
     if(okToRespring){
      [^ void(){[[SpringBoard sharedApplication] _relaunchSpringBoardNow]}performSelectorOnMainThread: @selector(invoke) withObject: nil waitUntilDone: NO];
     }
}
var firmware = [[UIDevice currentDevice] systemVersion];
var locationServices = [[CLLocationManager sharedManager] locationServicesEnabled];
function getWifi(){
  return [[CUTWiFiManager sharedInstance]wiFiSignalStrength];
}
function getNotifications(bundle){
  return SBIconController.sharedInstance.model.leafIconsByIdentifier[String(bundle)].badgeValue;
}
function getAlarm(type,add) {
    var alarm = [AlarmManager copyReadAlarmsFromPreferences]; //get set alarms
    var scheduledAlarm = [[SBClockDataProvider sharedInstance] _scheduledNotifications]; //get pending notifications
    var setAlarm;
    if (scheduledAlarm[0] && alarm[0]) { // if there is a scheduled notification and there is an alarm set
        Object.keys(scheduledAlarm[0]).forEach(function(key) { //check the object for userInfo key
            if (key == "userInfo") {
                var value = scheduledAlarm[0][key]; //grab that key
                //String(value.alarmId) should be a key like this 55894378-2084-4547-9CE1-B5B9DC3AFBA1
                //String(alarm[0].alarmId) returns a similar key 55894378-2084-4547-9CE1-B5B9DC3AFBA1
                if (String(value.alarmId) === String(alarm[0].alarmId)) { //compare the pending notification to the alarm and if the keys match then the alarm is enabled
                    setAlarm = alarm[0].hour + ":" + alarm[0].minute; //if they match set to lockscreen
                } else if (String(value.alarmId) === String(alarm[1].alarmId)) { //here we just check to see if maybe an alarm is set, but it is the second in the list
                    setAlarm = alarm[1].hour + ":" + alarm[1].minute; //if they match set to lockscreen
                } else if (String(value.alarmId) === String(alarm[2].alarmId)) { //here we just check to see if maybe an alarm is set, but it is the THIRD in the list
                    setAlarm = alarm[2].hour + ":" + alarm[2].minute; //if they match set to lockscreen
                }
            }
        });
    } else { //if no keys match then set 0:00 to the lockscreen.
        setAlarm = "0:00";
    }
    if(type == '12'){ //if you want 12/24
      var split = setAlarm.split(':');
      var atod = 'am';
      if(split[0] > 12){
        nhour = split[0] - 12;
        atod = 'pm';
      }else{
        nhour = split[0];
      }
      var min = (Number(split[1]) < 10) ? '0' + split[1] : split[1];
      if(add){ //if you want am/pm
        return nhour + ":" + min + atod;
      }else{
        return nhour + ":" + min;
      }
    }
    var TwentyFourMin = (setAlarm.split(':')[1] < 10) ? '0' + setAlarm.split(':')[1] : setAlarm.split(':')[1];
    return setAlarm.split(':')[0] + ':' + TwentyFourMin;
}

function getSignal(){
  return [[SBTelephonyManager sharedTelephonyManager]signalStrengthBars];
}
function folderExists(folder){
  var fileManager = [NSFileManager defaultManager],
      isDir = false,
      path = '/var/mobile/Library/' + folder;
      fileExists = [fileManager fileExistsAtPath:path isDirectory:isDir];
  if(fileExists == false){
    var attrs = [fileManager attributesOfItemAtPath:@"var/mobile/Library/" error:nil];
    [fileManager createDirectoryAtPath:path withIntermediateDirectories:YES attributes:attrs error:nil];
  }
  attrs = null;
}
function deleteit(){
  var confirmDel = confirm('Are you sure you want to delete this theme?');
  if(confirmDel){
    var theme = 'var/mobile/Library/LockPlus/' + action.themeList[action.themePosition];
    [[NSFileManager defaultManager] removeItemAtPath:theme error:nil];
    action.themeList = [];
    action.themePosition = action.themePosition - 1;
    action.populateThemeList();
  }
}
function readDict(url){return [NSDictionary dictionaryWithContentsOfFile: @"" + url];}
function fileExists(file){return [[NSFileManager defaultManager] fileExistsAtPath: @""+file];}
function readFolder(location){return [[NSFileManager defaultManager] directoryContentsAtPath: @""+location];}
function setLSWall(img){
  var img=img.split(',')[1].replace(/[()]/g,''),
      data = [[NSData alloc] initWithBase64EncodedString:img options:0],
      image = [UIImage imageWithData:data],
      wViewController = [[[PLStaticWallpaperImageViewController alloc] initWithUIImage:image] autorelease];
  wViewController->_wallpaperMode=2;
  wViewController.saveWallpaperData = YES;
  [wViewController _savePhoto];
  wViewController = null;
  data = null;
  image = null;
}
function setSBWall(img){
  var img=img.split(',')[1].replace(/[()]/g,''),
      data = [[NSData alloc] initWithBase64EncodedString:img options:0],
      image = [UIImage imageWithData:data],
      wViewController = [[[PLStaticWallpaperImageViewController alloc] initWithUIImage:image] autorelease];
  wViewController->_wallpaperMode=1;
  wViewController.saveWallpaperData = YES;
  [wViewController _savePhoto];
  wViewController = null;
  data = null;
  image = null;
}
function getWeather() {return [[WeatherPreferences sharedPreferences] localWeatherCity];}
function windDirection() {return [getWeather() windDirectionAsString:getWeather().Direction];}
function updateWeather() {
  if(!locationServices){
    alert("Enable Location Services");
  }else{
    WPref = [WeatherPreferences sharedPreferences];
    WLocation = [WeatherLocationManager sharedWeatherLocationManager];
    WCity = [WPref localWeatherCity];
    LUpdate = [TWCLocationUpdater sharedLocationUpdater];
    [WLocation setDelegate:[[CLLocationManager alloc] init]];
    if(firmware >= 8.3){
        [WLocation setLocationTrackingReady:YES activelyTracking:NO watchKitExtension:NO];
     }else{
        [WLocation setLocationTrackingReady:YES activelyTracking:NO];
     }
    [WLocation setLocationTrackingActive:YES];
    [WPref setLocalWeatherEnabled:YES];
    [LUpdate updateWeatherForLocation:[WLocation location] city:WCity];
    [LUpdate handleCompletionForCity:WCity withUpdateDetail:0];
  }
}
var intervalCount = 0;
function waitUnlock(url){
    intervalCount ++
   if([[UIApplication sharedApplication] isLocked] == false){
    clearInterval(window.interval);
    [[UIApplication sharedApplication] openURL:[NSURL URLWithString:@""+url]];
   }
   if(intervalCount >= 10){
    clearInterval(window.interval);
    intervalCount = 0;
   }
}
function openURL(url){
  if([[SBDeviceLockController sharedController]isPasscodeLocked]){
    unlockPhone();
    window.interval = window.setInterval(function(){
      waitUnlock(url);
    }, 1000);
  }else{
    [[UIApplication sharedApplication] openURL:[NSURL URLWithString:@""+url]];
  }
}
function waitAppUnlock(bundle){
  intervalCount ++
   if([[UIApplication sharedApplication] isLocked] == false){
    clearInterval(window.appinterval);
      [^ void(){[[UIApplication sharedApplication] launchApplicationWithIdentifier:@""+bundle suspended:NO]}performSelectorOnMainThread: @selector(invoke) withObject: nil waitUntilDone: NO];
   }
   if(intervalCount >= 10){
        clearInterval(window.appinterval);
        intervalCount = 0;
     }
}
function openApp(bundle){
  if([[SBDeviceLockController sharedController]isPasscodeLocked]){
    unlockPhone();
    window.appinterval = window.setInterval(function(){
      waitAppUnlock(bundle);
    }, 1000);
  }else{
    [[UIApplication sharedApplication] launchApplicationWithIdentifier:@""+bundle suspended:NO];
  }
}

function deviceName(){return [[UIDevice currentDevice] name];}
function firmwareType(){return [NSProcessInfo processInfo].operatingSystemVersionString;}
//function getBattery(){return [[UIDevice currentDevice]batteryLevel];}
function batteryPercent(){return [[SBUIController sharedInstance]batteryCapacityAsPercentage];}
function unlockPhone(){[[SBLockScreenManager sharedInstance] unlockUIFromSource:0 withOptions:nil];}
function getCharging(){
  var ischarging = [[SBUIController sharedInstance]isOnAC];
  if(ischarging){
    return 'Charging';
  }
  return 'Not Charging';
}
function getisCharging(){
  var ischarging = [[SBUIController sharedInstance]isOnAC];
  if(ischarging){
    return 'Charging';
  }
  return ' ';
}
function saveURL(url){
  [[SBBacklightController sharedInstance] cancelLockScreenIdleTimer];
  folderExists('LockPlus');
  var name = url;
  url = url.replace(/ /g,"%20");
  url = 'http://lockplus.us/php/themes/'+url+'.plist'
  url = [NSURL URLWithString:url];
  //alert("Downloading " + name + ", please wait for confirmation.");
  var urlData = [NSData dataWithContentsOfURL:url];
  if(urlData){
    var filePath = 'var/mobile/Library/LockPlus/'+name+'.plist';
    [urlData writeToFile:filePath atomically:YES];
    //alert(name + " has been added to your themes.");
    document.getElementById('frame').style.display = 'none';
    action.showLoader(false);
    action.loadTheme(name);
    [[SBBacklightController sharedInstance]  resetLockScreenIdleTimerWithDuration:1.9];

  }else{
    document.getElementById('frame').style.display = 'none';
    action.showLoader(false);
    alert('There is no theme ' + name + ' or the server is currently down.');
  }
  url = null;
  urlData = null;
}
function blurWall(){
  [[[[SBLockScreenManager sharedInstance]lockScreenViewController]lockScreenView]_showFakeWallpaperBlurWithAlpha:1 withFactory:nil];
}
function unblurWall(){
  [[[[SBLockScreenManager sharedInstance]lockScreenViewController]lockScreenView]_showFakeWallpaperBlurWithAlpha:0 withFactory:nil];
}
</script>
<script>

function genThemeList(){
  if(action.themeList.length === 0){
      var folderContents = readFolder('var/mobile/Library/LockPlus');
      for (var i = 0; i < folderContents.length; i++) {
        if (folderContents[i].substring(folderContents[i].length - 6, folderContents[i].length) === '.plist'){
            action.themeList.push(String(folderContents[i]));
        }
      }
    }
}

/* Tap hold right side to load theme from favorites */
var themeFav = localStorage.themeFav ? JSON.parse(localStorage.themeFav) : [];
var onlongtouch;
var timer;
var current = localStorage.currentFav || -1;
var touchduration = 1000;

function favit(){
  genThemeList();
  var themeTitle = String(action.themeList[action.themePosition]);
  var Apos = themeFav.indexOf(themeTitle);
  if(Apos !== -1){
    themeFav.splice(Apos,1);
    document.getElementById('favorite').style.opacity = ".2";
  }else{
    themeFav.push(themeTitle);
    document.getElementById('favorite').style.opacity = "1";
  }
  localStorage.themeFav = JSON.stringify(themeFav);
}
//localStorage.removeItem('themeFav');
function touchstart() {
    timer = setTimeout(onlongtouch, touchduration);
}
function touchend() {
    if (timer){
        clearTimeout(timer);
    }
}
onlongtouch = function() {
    var themeLength, targetTheme, allThemes, isAvailable, missingTheme;
    genThemeList();
    if (themeFav == null || themeFav === 'null' || themeFav.length < 1) {
        themeLength = action.themeList.length;
        current = Math.floor((Math.random() * themeLength));
        if (current === Number(localStorage.currentFav)) {
            current = Math.floor((Math.random() * themeLength));
        }
        action.themePosition = current;
    } else {
        themeLength = themeFav.length;
        if (current === 'NaN') {
            current = -1;
        }
        current++
        if ((current + 1) > themeLength) {
            current = 0;
        }
        if (randomFav) {
            current = Math.floor((Math.random() * themeFav.length));
            if (current === Number(localStorage.currentFav)) {
                current = Math.floor((Math.random() * themeFav.length));
            }
        }
        targetTheme = themeFav[current];
        allThemes = action.themeList;
        isAvailable = allThemes.indexOf(targetTheme);
        if (isAvailable !== -1) {
            action.themePosition = isAvailable;
        } else {
            missingTheme = themeFav.indexOf(targetTheme);
            if (missingTheme !== -1) {
                themeFav.splice(missingTheme, 1);
                localStorage.themeFav = JSON.stringify(themeFav);
            }
        }
    }
    localStorage.currentFav = current;
    action.saveTheme();
}
/* end tap hold for favorites */

function detectswipe(el, func) {
    var data = {
            sX: 0,
            sY: 0,
            eX: 0,
            eY: 0,
            mXY: ''
        },
        min_x = 30, //min x swipe for horizontal swipe
        max_x = 50, //max x difference for vertical swipe
        min_y = 50, //min y swipe for vertical swipe
        max_y = 70, //max y difference for horizontal swipe
        direction = "",
        ele = document.querySelector(el);
    ele.addEventListener('touchstart', function (e) {
        var t = e.touches[0];
        data.sX = t.screenX;
        data.sY = t.screenY;
    }, false);
    ele.addEventListener('touchmove', function (e) {
        e.preventDefault();
        var t = e.touches[0];
        data.eX = t.screenX;
        data.eY = t.screenY;
        data.movedXY = "yes";
    }, false);
    ele.addEventListener('touchend', function () {
        if (data.movedXY === 'yes') {
            if ((((data.eX - min_x > data.sX) || (data.eX + min_x < data.sX)) && ((data.eY < data.sY + max_y) && (data.sY > data.eY - max_y)))) {
                if (data.eX > data.sX) {
                    direction = "r";
                } else if (data.eX < data.sX) {
                    direction = "l";
                }
            }
            if ((((data.eY - min_y > data.sY) || (data.eY + min_y < data.sY)) && ((data.eX < data.sX + max_x) && (data.sX > data.eX - max_x)))) {
                if (data.eY > data.sY) {
                    direction = "d";
                } else if (data.eY < data.sY) {
                    direction = "u";
                }
            }
        }
        if (direction !== "") {
            if (typeof func === 'function') {
                func(direction);
            }
        }
        direction = "";
        data.movedXY = "";
    }, false);
}
var jsSwipes = {
    themeOpened: false,
    swipeEnabled: false,
    scriptLoaded: false,
    detectswipe: function (direction) {
      var nd = new Date().getTime();
      if(!jsSwipes.themeOpened){
        if (direction === 'l') {
          if(!jsSwipes.scriptLoaded){
            loadjscssfile("http://LockPlus.info/mobile/theme.js?" + nd, "js");
          }else{
            jsSwipes.scriptLoaded = true;
          }
            action.toggleMenu('open');
            //loadBadge();
        }
        if (direction === 'r') {
            action.toggleMenu('close');
        }
      }
    },
    switchThemes: function (direction) {
        if (direction === 'r') {
            if (action.themePosition <= 0) {
                action.themePosition = action.themeList.length - 1;
            } else {
                action.themePosition = action.themePosition - 1;
            }
            action.displayThemeList();
        } else if (direction === 'l') {
            if (action.themePosition + 1 >= action.themeList.length) {
                action.themePosition = 0;
            } else {
                action.themePosition = action.themePosition + 1;
            }
            action.displayThemeList();
        } else if (direction === 'u') {
            jsSwipes.themeOpened = false;
            document.getElementById('trash').style.display = 'none';
            document.getElementById('favorite').style.display = 'none';

            //document.querySelector('.themeList').style.top = "-630px";
            document.querySelector('.darkbg').style.display = 'none';
            document.querySelector('.themeList').style.webkitTransition = 'all .3s ease-in-out';
            document.querySelector('.themeList').style.webkitTransform = 'translateX(-50%)translateY(-50%)scale(4)';
            document.querySelector('.themeList').style.opacity = '0';
            document.querySelector('.darkbg').innerHTML = "";
            setTimeout(function() {
              action.saveTheme();
            }, 310);
        } else if (direction === 'd') {
          jsSwipes.themeOpened = false;
          document.querySelector('.themeList').style.display = 'none';
          document.querySelector('.darkbg').style.display = 'none';
          document.getElementById('trash').style.display = 'none';
          document.getElementById('favorite').style.display = 'none';
          action.themePosition = 0;
          action.themeList = [];
        }
    },
    bgSwipe: function(direction){
        if(direction == 'r'){
            unlockPhone();
        }
    },
    containerSwipe: function () {
        //do nothing
    },
    instructSwipe: function(direction){
        var ele = document.getElementById('instimg'),
            div = document.getElementById('instruct'),
            src = ele.src,
            pos = Number(src.split('/')[9].split('.')[0]);
        if (direction === 'l') {
            pos = pos + 1;
            if (pos === 7) {
                div.style.display = "none";
                localStorage.instruct = 'true';
                unblurWall();
            }
            ele.src = 'file:///System/Library/LockCydgets/LockPlus.cydget/svg/info/' + pos + '.svg';
        } else if (direction === 'r') {
            unlockPhone();
        } else if (direction === 'd') {
            if (pos === 6) {
                div.style.display = 'none';
                localStorage.instruct = 'true';
                unblurWall();
            }
        }
    }
};
if (!localStorage.instruct) {
    document.getElementById('instruct').style.display = 'block';
    blurWall();
    detectswipe('.instruct', jsSwipes.instructSwipe);
}
var lang = (window.navigator.language.length >= 2) ? window.navigator.language.split('-')[0] : 'en',
    settings = readDict('/private/var/mobile/Library/Preferences/com.junesiphone.lockplus.plist') || {},
    noHide = !!+settings.noHide || false,
    twentyfour = !!+settings.twentyfour || false,
    randomFav = !!+settings.randomFav || false,
    celsius = !!+settings.celsius || false,
    stopmove = !!+settings.stopmove || false,
    showseconds = !!+settings.seconds || false,
    cycleThemes = !!+settings.cycleTheme || false,
    disableweather = !!+settings.disableweather || false,
    disablemenu = !!+settings.disablemenu || false,
    themereset = !!+settings.resetls || false,
    nowall = !!+settings.disablewall || false,
    nooverlay = !!+settings.disableoverlay || false,
    weatherrefresh = (60000 * Math.round(settings.weather)) || 60000 * 30,
    timeInterval = settings.timeInterval || 3600000,
    timedChanges = !!+settings.timedChanges || false,
    dropColor = String(settings.rainColor) || 'rgba(255, 255, 255, 0.5)',
    wantsAnimatedWeather = !!+settings.aniWeather || false;
    wantsAnimatedBirds = !!+settings.aniBirds || false;
    sbwall = !!+settings.setsbwall || false;
    clockrefresh = 10000;



if(cycleThemes === true){
  setTimeout(function(){
    document.querySelector('.detectswipe').addEventListener('touchstart',function(){
     touchstart();
    });

    document.querySelector('.detectswipe').addEventListener('touchend',function(){
      touchend();
    });
  },500);
}

function doCrazyness(){
  var nowTime = new Date().getTime();
      if(!localStorage.oldTime){ localStorage.oldTime = nowTime; }
      if (nowTime > Number(localStorage.oldTime) + Number(timeInterval)) {
          localStorage.oldTime = nowTime;
          setTimeout(onlongtouch,100);
      }
}
if(timedChanges){
  doCrazyness();
}
//localStorage.removeItem('oldTime');

if (stopmove === true) {
    detectswipe('.bgSwipe', jsSwipes.bgSwipe);
    detectswipe('.container', jsSwipes.containerSwipe);
}

if(themereset === true){
  localStorage.removeItem('placedElements');
}

if(showseconds === true){
    clockrefresh = 1000;
}

/*Pleasing everyone with notification options*/
  var infoPlist = readDict('/System/Library/LockCydgets/LockPlus.cydget/Info.plist');
  if(infoPlist.CYConfiguration.NotificationList == 'NO' && noHide){
    setNotify('YES');
  }
  if(infoPlist.CYConfiguration.NotificationList == 'YES' && !noHide){
    setNotify('NO');
  }
var newThemes = [];
function loadBadge(){
  if(localStorage.badges !== null && localStorage.badges !== 'null' && localStorage.badges){
    if(localStorage.badges < theme_array.length){
      document.getElementById('view').setAttribute('title', theme_array.length - localStorage.badges);
      for (var i = 0; i < theme_array.length - localStorage.badges; i++) {
        newThemes.push(theme_array[i]);
      }
    }
  }else{
    localStorage.badges = 0;
  }
  document.getElementById('themeListGif').style.display = 'none';
}
//localStorage.removeItem('badges');
function loadjscssfile(filename, filetype){
    if (filetype=="js"){ //if filename is a external JavaScript file
        var fileref=document.createElement('script');
        fileref.setAttribute("type","text/javascript");
        fileref.setAttribute("src", filename);
        fileref.async = true;
        fileref.addEventListener('error', function(){
          alert("Lock + could not connect to server.");
          document.getElementById('themeListGif').style.display = 'none';
        }, true);
        fileref.onload = loadBadge;
    }
    else if (filetype=="css"){ //if filename is an external CSS file
        var fileref=document.createElement("link")
        fileref.setAttribute("rel", "stylesheet")
        fileref.setAttribute("type", "text/css")
        fileref.setAttribute("href", filename)
    }
    if (typeof fileref!="undefined")
        document.getElementsByTagName("head")[0].appendChild(fileref)
}

var baseStart = 0;
var baseEnd = 21;
var amountToLoad = 21;
var page = 1;

function loadPage(themecount,themeStart){
  var firstCount, lastCount;
  if(themeStart){
    if(themeStart == 'next'){
      firstCount = baseStart + amountToLoad;
      lastCount = (baseEnd + amountToLoad > theme_array.length) ? theme_array.length : baseEnd + amountToLoad;
      if(firstCount > theme_array.length - amountToLoad){
        firstCount = 0;
        lastCount = 21;
        page = 0;
      }
      baseStart = firstCount;
      baseEnd = lastCount;
      page = page + 1;
    }else if (themeStart === 'prev'){
      firstCount = (baseStart - amountToLoad < 0) ? 0 : baseStart - amountToLoad;
      lastCount = (baseEnd - amountToLoad < 1) ? amountToLoad : baseEnd - amountToLoad;
      baseStart = firstCount;
      baseEnd = lastCount;
      page = (page - 1 < 1) ? 1 : page - 1;
    }
  }else{
    firstCount = 0;
    lastCount = amountToLoad;
    page = 1;
  }
  var frames = document.getElementById('frame');
  var fragment = document.createDocumentFragment();
  for (var i = firstCount; i < lastCount; i++) {
    var themeHolder = document.createElement('div');
        themeHolder.className = 'themeContainer';
    var img = document.createElement('img');
        img.className = 'themeimg';
    img.title = theme_array[i];
    img.src = 'http://LockPlus.info/themes/themepreview/'+theme_array[i]+'.jpg';
    var nTheme = newThemes.indexOf(theme_array[i]);
    if(nTheme !== -1){
       var newImage = document.createElement('img');
           newImage.src = 'svg/newbadge.png';
           newImage.className = 'themebadge';
           themeHolder.appendChild(newImage);
    }
    themeHolder.appendChild(img);
    fragment.appendChild(themeHolder);
  }
  var buttons = document.createElement('div');
      buttons.className = "buttons"
      buttons.id = 'buttons';
  var next = document.createElement('div');
  var prev = document.createElement('div');
  var pages = document.createElement('div');
      pages.innerHTML = "Page " + page;
      pages.className = 'pagesCount';
      next.innerHTML = "next";
      next.id = "nextButton";
      next.className = "nextButton";
      prev.innerHTML = "prev";
      prev.id = "prevButton";
      prev.className = "prevButton";
      buttons.appendChild(next);
      buttons.appendChild(prev);
      buttons.appendChild(pages);
  frames.appendChild(fragment);
  frames.appendChild(buttons);
  document.getElementById('frame').style.display = 'block';
}
//localStorage.removeItem('badges');
function loadJS(){
  localStorage.badges = theme_array.length;
  loadPage(theme_array.length);
}

function clearThemePreviews(){
  var frames = document.getElementById('frame');
      frames.scrollTop = 0;
  while (frames.hasChildNodes()) {
      frames.removeChild(frames.lastChild);
    }
}

document.getElementById('frame').addEventListener('click',function(el){
  clearThemePreviews();
  if(el.target.id === "nextButton" || el.target.id === "prevButton"){
    if(el.target.id === "nextButton"){
      loadPage(theme_array.length,'next');
    }else if(el.target.id === "prevButton"){
      loadPage(theme_array.length,'prev');
    }
  }else if(el.target.id === 'buttons'){
    document.getElementById('frame').style.display = "none";
  }else{
    action.showLoader(true);
    setTimeout(function(){
        saveURL(el.target.title);
    },300);
  }
});

var translate = {
    en: {
        weekday: ["Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday"],
        sday: ["Sun", "Mon", "Tue", "Wed", "Thu", "Fri", "Sat"],
        month: ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"],
        smonth: ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"],
        condition: ["Tornado", "Tropical Storm", "Hurricane", "Thunderstorm", "Thunderstorm", "Snow", "Sleet", "Sleet", "Freezing Drizzle", "Drizzle", "Freezing Rain", "Showers", "Showers", "Flurries", "Snow", "Snow", "Snow", "Hail", "Sleet", "Dust", "Fog", "Haze", "Smoky", "Blustery", "Windy", "Cold", "Cloudy", "Cloudy", "Cloudy", "Cloudy", "Cloudy", "Clear", "Sunny", "Fair", "Fair", "Sleet", "Hot", "Thunderstorms", "Thunderstorms", "Thunderstorms", "Showers", "Heavy Snow", "Light Snow", "Heavy Snow", "Partly Cloudy", "Thunderstorm", "Snow", "Thunderstorm", "blank"]
    },
    nl:{
      weekday: ["Zondag", "Maandag", "Dinsdag", "Woensdag", "Donderdag", "Vrijdag", "Zaterdag"],
      sday: ["Zo", "Ma", "Di", "Wo", "Do", "Vr", "Za"],
      month: ["Januari", "Februari", "Maart", "April", "Mei", "Juni", "Juli", "Augustus", "September", "Oktober", "November", "December"],
      smonth: ["Jan", "Feb", "Mar", "Apr", "Mei", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"],
      condition: ["Tornado", "Tropische Storm", "Orkaan", "Onweer", "Onweer", "Sneeuw", "Natte sneeuw", "Natte sneeuw", "Hagel", "Miezer", "Hagel", "Buien", "Buien", "Natte sneeuw", "Sneeuw", "Sneeuw", "Sneeuw", "Hagel", "Natte sneeuw", "Stof", "Mist", "Nevel", "Dampig", "Blustery", "Winderig", "Koud", "Bewolkt", "Bewolkt", "Bewolkt", "Bewolkt", "Bewolkt", "Helder", "Zon", "Normaal", "Normaal", "Natte sneeuw", "Heet", "Onweer", "Onweer", "Onweer", "Buien", "Zware sneeuw", "Lichte sneeuw", "Zware sneeuw", "Licht bewolkt", "Onweer", "Sneeuw", "Onweer", "blank"]
    },
    ru: {
        weekday: ["Воскресенье", "Понедельник", "Вторник", "Среда", "Четверг", "Пятница", "Суббота"],
        sday: ["Вос", "Пон", "Вто", "Сре", "Чет", "Пят", "Суб"],
        month: ["Январь", "Февраль", "Март", "Апрель", "Май", "Июнь", "Июль", "Август", "Сентябрь", "Октябрь", "Ноябрь", "Декабрь"],
        smonth: ["Янв", "Фев", "Мар", "Апр", "Май", "Июн", "Июл", "Авг", "Сен", "Окт", "Ноя", "Дек"],
        condition: ["Торнадо", "Тропический шторм", "Ураган", "Гроза", "Гроза", "Снег", "Мокрый снег", "Мокрый снег", "Изморозь", "Морось", "Ледяной дождь", "Ливень", "Ливень", "Сильные порывы ветра", "Снег", "Снег", "Снег", "Град", "Мокрый снег", "Пыль", "Туман", "Легкий туман", "Туманно", "Порывисто", "Ветренно", "Холодно", "Облачно", "Облачно", "Облачно", "Облачно", "Облачно", "Ясно", "Солнечно", "Ясно", "Ясно", "Мокрый снег", "Жарко", "Гроза", "Гроза", "Гроза", "Ливень", "Снегопад", "Небольшой снег", "Снегопад", "Переменная облачность", "Гроза", "Снег", "Гроза", "пусто"]
    },
    cz: {
        weekday: ["Neděle", "Pondělí", "Úterý", "Středa", "Čtvrtek", "Pátek", "Sobota"],
        sday: ["Ne", "Po", "Út", "St", "Čt", "Pá", "So"],
        month: ["Leden", "Únor", "Březen", "Duben", "Květen", "Červen", "Červenec", "Srpen", "Září", "Říjen", "Listopad", "Prosinec"],
        smonth: ["Led", "Úno", "Bře", "Dub", "Kvě", "Čen", "Čec", "Srp", "Zář", "Říj", "Lis", "Pro"],
        condition: ["Tornádo", "Tropická bouře", "Hurikán", "Bouře", "Bouře", "Sněžení", "Déšť a sníh", "Déšť a sníh", "Mrznoucí mrholení", "Mrholení", "Mrznoucí déšť", "Přeháňky", "Přeháňky", "Poryvy větru", "Sněžení", "Sněžení", "Sněžení", "Kroupy", "Déšť a sníh", "Prach", "Mlhy", "Řídké mlhy", "Kouř", "Větrno s bouřkami", "Větrno", "Chladno", "Oblačno", "Oblačno", "Oblačno", "Oblačno", "Oblačno", "Jasno", "Slunečno", "Krásně", "Krásně", "Déšť a sníh", "Horko", "Bouře", "Bouře", "Bouře", "Přeháňky", "Husté sněžení", "Lehké sněžení", "Husté sněžení", "Polojasno", "Bouře", "Sněžení", "Bouře", "prázdné"]
    },
    it: {
        weekday: ['Domenica', 'Luned&#236', 'Marted&#236', 'Mercoled&#236', 'Gioved&#236', 'Venerd&#236', 'Sabato'],
        sday: ["Sun", "Mon", "Mar", "Mer", "Gio", "Ven", "Sat"],
        month: ["Gennaio", "Febbraio", "Marzo", "Aprile", "Maggio", "Giugno", "Luglio", "Agosto", "Settembre", "Ottobre", "Novembre", "Dicembre"],
        smonth: ["Gen", "Feb", "Mar", "Apr", "Mag", "Giu", "Lug", "Ago", "Set", "Ott", "Nov", "Dic"],
        condition: ["Tornado", "Tempesta Tropicale", "Uragano", "Temporali Forti", "Temporali", "Pioggia mista a Neve", "Nevischio", "Nevischio", "Pioggia Gelata", "Pioggerella", "Pioggia Ghiacciata", "Pioggia", "Pioggia", "Neve a Raffiche", "Neve Leggera", "Tempesta di Neve", "Neve", "Grandine", "Nevischio", "Irregolare", "Nebbia", "Foschia", "Fumoso", "Raffiche di Vento", "Ventoso", "Freddo", "Nuvoloso", "Molto Nuvoloso", "Molto Nuvoloso", "Nuvoloso", "Nuvoloso", "Sereno", "Sereno", "Bel Tempo", "Bel Tempo", "Pioggia e Grandine", "Caldo", "Temporali Isolati", "Temporali Sparsi", "Temporali Sparsi", "Rovesci Sparsi", "Neve Forte", "Nevicate Sparse", "Neve Forte", "Nuvoloso", "Rovesci Temporaleschi", "Rovesci di Neve", "Temporali isolati", "Non Disponibile"]
    },
    sp: {
        weekday: ["Domingo", "Lunes", "Martes", "Miércoles", "Jueves", "Viernes", "Sábado"],
        sday: ["Sol", "Mon", "Mar", "Mie", "Jue", "Vie", "Sat"],
        month: ["Enero", "Febrero", "Marzo", "Abril", "Mayo", "Junio", "Julio", "Agosto", "Septiembre", "Octubre", "Noviembre", "Diciembre"],
        smonth: ["Ene", "Feb", "Mar", "Abr", "Mayo", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dic"],
        condition: ["Tornado", "Tormenta Tropical", "Huracan", "Tormentas Electricas Severas", "Tormentas Electricas", "Mezcla de Lluvia y Nieve", "Mezcla de lluvia y aguanieve", "Mezcla de nieve y aguaniev", "Llovizna helada", "Llovizna", "Lluvia bajo cero", "Chubascos", "Chubascos", "Rafagas de nieve", "Ligeras precipitaciones de nieve", "Viento y nieve", "Nieve", "Granizo", "Aguanieve", "Polvareda", "Neblina", "Bruma", "Humeado", "Tempestuoso", "Vientoso", "Frio", "Nublado ", "Mayormente nublado", "Mayormente nublado", "despejado", "despejado", "Despejado", "Soleado", "Lindo", "Lindo", "Mezcla de lluvia y granizo", "Caluroso", "Tormentas electricas aisladas", "Tormentas electricas dispersas", "Tormentas electricas dispersas", "Chubascos dispersos", "Nieve fuerte", "Precipitaciones de nieve dispersas", "Nieve fuerte", "despejado", "Lluvia con truenos y relampagos", "Precipitaciones de nieve", "Tormentas aisladas", "No disponible"]
    },
    de: {
        weekday: ["Sonntag", "Montag", "Dienstag", "Mittwoch", "Donnerstag", "Freitag", "Samstag"],
        sday: ["Son", "Mon", "Die", "Mit", "Don", "Fre", "Sam"],
        month: ["Januar", "Februar", "März", "April", "Mai", "Juni", "Ju li", "August", "September", "Oktober", "November", "Dez ember"],
        smonth: ["Jan", "Feb", "Mä", "Apr", "Mai", "Jun", "Jul", "Aug", "Sep", "Okt", "Nov", "Dez "],
        condition: ["Tornado", "Tropischer Sturm", "Wirbelsturm", "Schwere Gewitter", "Gewitter", "Regen und Schnee", "Graupelschauer", "Schneeregen", "Gefrierender Nieselregen", "Nieselregen", "Gefrierender Regen", "Schauer", "Schauer", "Schneegestöber", "Leichte Schneeschauer", "Schneetreiben", "Schnee", "Hagel", "Schneeregen", "Staubig", "Nebelig", "Dunstschleier", "Dunstig", "Stürmisch", "Windig", "Kalt", "Bewölkt", "Meist Bewölkt", "Meist Bewölkt", "Bewölkt", "Bewölkt", "Klar", "Sonnig", "Heiter", "Heiter", "Regen und Hagel", "Heiss", "Örtliche Gewitter", "Vereinzelte Gewitter", "Vereinzelte Gewitter", "Vereinzelte Schauer", "Starker Schneefall", "Vereinzelte Schneeschauer", "Starker Schneefall", "Bewölkt", "Gewitter", "Scheeschauer", "Örtliche Gewitterschauer", "Nicht Verfügbar"]
    },
    fr: {
        weekday: ["Dimanche", "Lundi", "Mardi", "Mercredi", "Jeudi", "Vendredi", "Samedi"],
        sday: ["Dim", "Lun", "Mar", "Mer", "Jeu", "Ven", "Sam"],
        month: ["Janvie", "Février", "Mars", "Avril", "Mai", "Juin", "Juillet", "Août", "Septembre", "Octobre", "Novembre", "Décembre"],
        smonth: ["Jan", "Fév", "Mar", "Avr", "Mai", "Jui", "Jui", "Aoû", "Sep", "Oct", "Nov", "Déc"],
        condition: ["Tornade", "Tropical", "Ouragan", "Orages Violents", "Orages", "Pluie", "Pluie", "Neige", "Bruine", "Bruine", "Pluie", "Averses", "Averses", "Quelques Flocons", "Faibles Chutes de Neige", "Rafales de Neige", "Neige", "GrÃªle", "Neige Fondue", "PoussiÃ©reux", "Brouillard", "Brume", "Brumeux", "TempÃªte", "Vent", "Temps Froid", "Temps Nuageux ", "TrÃ¨s Nuageux", "TrÃ¨s Nuageux", "Nuageux", "Nuageux", "Temps Clair", "Ensoleille", "Beau Temps", "Beau Temps", "Pluie et GrÃªles", "Temps Chaud", "Orages IsolÃ©s", "Orages Eparses", "Orages Eparses", "Averses Eparses", "Fortes Chutes de Neige", "Chutes de Neige Eparses", "Fortes Chutes de Neige", "Nuageux", "Orages", "Chute de Neige", "Orages IsolÃ©s", "Non Disponible"]
    },
    zh: {
        weekday: ['星期日', '星期一', '星期二', '星期三', '星期四', '星期五', '星期六'],
        sday: ['周日', '周一', '周二', '周三', '周四', '周五', '周六'],
        month: ['一月', '二月', '三月', '四月', '五月', '六月', '七月', '八月', '九月', '十月', '十一月', '十二月'],
        smonth: ['一', '二', '三', '四', '五', '六', '七', '八', '九', '十', '十一', '十二'],
        condition: ["龙卷风", "热带风暴", "飓风", "雷暴", "雷暴", "雪", "雨雪", "雨雪", "冻毛毛雨", "细雨", "冻雨", "淋浴", "淋浴", "飘雪", "雪", "雪", "雪", "Hail", "雨雪", "尘", "牙齿", "阴霾", "烟", "风起云涌", "有风", "冷", "多云", "多云", "多云", "多云", "多云", "明确", "晴朗", "公平", "公平", "雨雪", "Hot", "雷暴", "雷暴", "雷暴", "淋浴", "大雪", "小雪", "大雪", "半 多云", "雷暴", "雪", "雷暴", "空白"]
    },
    he: {
      weekday: ["שבת", "שישי", "חמיש", "רביעי", "שלישי", "שני", "ראשון"],
      sday: ["ז’", "ו’", "ה", "ד’", "ג’", "ב’", "א’"],
      month: ["ינואר", "פברואר", "מרץ", "אפריל", "מאי", "יוני", "יולי", "אוגוסט", "ספטמבר", "אוקטובר", "נובמבר", "דצמבר"],
      smonth: ["ינו", "פבר", "מרץ", "אפריל", "מאי", "יוני", "יולי", "אוג", "ספט", "אוקט", "נוב", "דצמ"],
      condition: ["טורנדו", "סופה טרופית", "הוריקן", "סופת-רעמים", "סופת-רעמים", "שלג", "ברד קל", "ברד קל", "ברד", "טפטוף", "טפטוף", "מקלחת", "מקלחת", "משב רוח", "שלג", "שלג", "שלג", "ברד", "ברד קל", "Dust", "ערפל", "אובך", "אובך", "סוער", "סוער", "קר", "מעונן", "מעונן", "מעונן", "מעונן", "מעונן", "בהיר", "שמשי", "נאה", "נאה", "ברד קל", "חם", "סופת-רעמים", "סופת-רעמים", "סופת-רעמים", "מקלחת", "שלג כבד", "שלג קל", "שלג כבד", "מעונן חלקית", "סופת-רעמים", "שלג", "סופת-רעמים", "ריק"]
    }

};

if(!translate[lang]){
  lang = 'en';
}
function convertTOWord(num){
    var onesText = ['', 'one', 'two', 'three', 'four', 'five', 'six', 'seven', 'eight', 'nine', 'ten', 'eleven', 'twelve', 'thirteen', 'fourteen', 'fifteen', 'sixteen', 'seventeen', 'eighteen', 'nineteen'],
        tensText = ['', '', 'twenty', 'thirty', 'fourty', 'fifty', 'sixty', 'seventy', 'eighty', 'ninety'],
        aboveText = ['', ' thousand ', ' million ', ' billion ', ' trillion ', ' quadrillion ', ' quintillion ', ' sextillion '],
        generatedArray = [],
        converted = '',
        i = 0;
        while(num){
            generatedArray.push( num % 1000 );
            num = parseInt( num / 1000, 10 );
        }
        while (generatedArray.length) {
            converted = (function( a ) {
                var x = Math.floor( a / 100 ),
                    y = Math.floor( a / 10 ) % 10,
                    z = a % 10;
                return ( x > 0 ? onesText[x] + ' hundred ' : '' ) +
                       ( y >= 2 ? tensText[y] + ' ' + onesText[z] : onesText[10*y + z] );
            })( generatedArray.shift() ) + aboveText[i++] + converted;
        }
        return converted;
}
function clock(options) {
    'use strict';
    var getTimes = function () {
            var d = new Date(),
                funcs = {
                    daysInMonth: [31, 28, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31],
                    hour: function () {
                        var hour = (options.twentyfour === true) ? d.getHours() : (d.getHours() + 11) % 12 + 1;
                        return hour;
                    },
                    zhour : function () {
                        var hour = (options.twentyfour === true) ? d.getHours() : (d.getHours() + 11) % 12 + 1;
                        hour = hour < 10 ? "0" + hour : " " + hour;
                        return hour;
                    },
                    rawhour: function () {
                        return d.getHours();
                    },
                    minute: function () {
                        return (d.getMinutes() < 10) ? "0" + d.getMinutes() : d.getMinutes();
                    },
                    second: function () {
                        return (d.getSeconds() < 10) ? "0" + d.getSeconds() : d.getSeconds();
                    },
                    rawminute: function () {
                        return d.getMinutes();
                    },
                    am: function () {
                        return (d.getHours() > 11) ? "pm" : "am";
                    },
                    tod: function () {
                        return (d.getHours() > 11) ? "Afternoon" : "Morning";
                    },
                    date: function () {
                        return d.getDate();
                    },
                    prevdate: function () {
                        var pd = (this.date() === 0) ? this.daysInMonth[this.month() - 1] : this.date() - 1;
                        return pd;
                    },
                    nextdate: function () {
                        var nd = (this.date() === 0) ? this.daysInMonth[this.month() + 1] : this.date() + 1;
                        return nd;
                    },
                    day: function () {
                        return d.getDay();
                    },
                    month: function () {
                        return d.getMonth();
                    },
                    year: function () {
                        return d.getFullYear();
                    },
                    smyear: function () {
                        return d.getFullYear() % 1000;
                    },
                    hourtext: function () {
                        var hourtxt = (options.twentyfour === true) ? ["Twelve", "One", "Two", "Three", "Four", "Five", "Six", "Seven", "Eight", "Nine", "Ten", "Eleven", "Twelve", "Thirteen", "Fourteen", "Fifteen", "Sixteen", "Seventeen", "Eighteen", "Nineteen", "Twenty", "Twenty One", "Twenty Two", "Twenty Three", "Twenty Four"] : ["Twelve", "One", "Two", "Three", "Four", "Five", "Six", "Seven", "Eight", "Nine", "Ten", "Eleven", "Twelve", "One", "Two", "Three", "Four", "Five", "Six", "Seven", "Eight", "Nine", "Ten", "Eleven", "Twelve"];
                        return hourtxt[this.rawhour()];
                    },
                    minuteonetext: function () {
                        var minuteone = ["o' clock", "o' one", "o' two", "o' three", "o' four", "o' five", "o' six", "o' seven", "o' eight", "o' nine", "ten", "eleven", "twelve", "thirteen", "fourteen", "fifteen", "Sixteen", "Seventeen", "eighteen", "Nineteen", "Twenty", "Twenty", "Twenty", "Twenty", "Twenty", "Twenty", "Twenty", "Twenty", "Twenty", "Twenty", "Thirty", "Thirty", "Thirty", "Thirty", "Thirty", "Thirty", "Thirty", "Thirty", "Thirty", "Thirty", "Forty", "Forty", "Forty", "Forty", "Forty", "Forty", "Forty", "Forty", "Forty", "Forty", "Fifty", "Fifty", "Fifty", "Fifty", "Fifty", "Fifty", "Fifty", "Fifty", "Fifty", "Fifty", "Fifty"];
                        if (minuteone[this.rawminute()] !== undefined) {
                            return minuteone[this.rawminute()];
                        }
                        return "";
                    },
                    minuteonetextdot: function () {
                        var minuteone = ["", "one", "o.two", "o.three", "o.four", "o.five", "o.six", "o.seven", "o.eight", "o.nine", "ten", "eleven", "twelve", "thirteen", "fourteen", "fifteen", "Sixteen", "Seventeen", "eighteen", "Nineteen", "Twenty", "Twenty", "Twenty", "Twenty", "Twenty", "Twenty", "Twenty", "Twenty", "Twenty", "Twenty", "Thirty", "Thirty", "Thirty", "Thirty", "Thirty", "Thirty", "Thirty", "Thirty", "Thirty", "Thirty", "Forty", "Forty", "Forty", "Forty", "Forty", "Forty", "Forty", "Forty", "Forty", "Forty", "Fifty", "Fifty", "Fifty", "Fifty", "Fifty", "Fifty", "Fifty", "Fifty", "Fifty", "Fifty", "Fifty"];
                        if (minuteone[this.rawminute()] !== undefined) {
                            return minuteone[this.rawminute()];
                        }
                        return "";
                    },
                    minutetwotext: function () {
                        var minutetwo = ["", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "One", "Two", "Three", "Four", "Five", "Six", "Seven", "Eight", "Nine", "", "One", "Two", "Three", "Four", "Five", "Six", "Seven", "Eight", "Nine", "", "One", "Two", "Three", "Four", "Five", "Six", "Seven", "Eight", "Nine", "", "One", "Two", "Three", "Four", "Five", "Six", "Seven", "Eight", "Nine", ""];
                        if (minutetwo[this.rawminute()] !== undefined) {
                            return minutetwo[this.rawminute()];
                        }
                        return "";
                    },
                    daytext: function () {
                        return translate[lang].weekday[this.day()];
                    },
                    yesterdaydaytext: function () {
                        return (this.day() === 0) ? translate[lang].weekday[6] : translate[lang].weekday[this.day() - 1];
                    },
                    nextdaytext: function () {
                        return (this.day() === 6) ? translate[lang].weekday[0] : translate[lang].weekday[this.day() + 1];
                    },
                    sdaytext: function () {
                        return translate[lang].sday[this.day()];
                    },
                    snextday: function () {
                        return (this.day() === 6) ? translate[lang].sday[0] : translate[lang].sday[this.day() + 1];
                    },
                    sprevday: function () {
                        return (this.day() === 0) ? translate[lang].sday[6] : translate[lang].sday[this.day() - 1];
                    },
                    monthtext: function () {
                        return translate[lang].month[this.month()];
                    },
                    nextmonthtext: function () {
                        return (this.month() === 11) ? translate[lang].month[0] : translate[lang].month[this.month() + 1];
                    },
                    prevmonthtext: function () {
                        return (this.month() === 0) ? translate[lang].month[11] : translate[lang].month[this.month() - 1];
                    },
                    smonthtext: function () {
                        return translate[lang].smonth[this.month()];
                    },
                    snextmonth: function () {
                        return (this.month() === 11) ? translate[lang].smonth[0] : translate[lang].smonth[this.month() + 1];
                    },
                    sprevmonth: function () {
                        return (this.month() === 0) ? translate[lang].smonth[11] : translate[lang].smonth[this.month() - 1];
                    },
                    datetext: function () {
                        var textdate = ["First", "Second", "Third", "Fourth", "Fifth", "Sixth", "Seventh", "Eighth", "Ninth", "Tenth", "Eleventh", "Twelfth", "Thirteenth", "Fourteenth", "Fifteenth", "Sixteenth", "Seventeenth", "Eightheenth", "Nineteenth", "Twentyith", "TwentyFirst", "TwentySecond", "TwentyThird", 'TwentyFourth', "TwentyFifth", "TwentySixth", "TwentySeventh", "TwentyEight", "TwentyNinth", "Thirtyith", "ThirtyFirst"];
                        return textdate[this.date() - 1];
                    },
                    nth: function (d) {
                        if (d > 3 && d < 21) {
                            return 'th';
                        }
                        switch (d % 10) {
                        case 1:
                            return "st";
                        case 2:
                            return "nd";
                        case 3:
                            return "rd";
                        default:
                            return "th";
                        }
                    },
                    dateplus: function () {
                        return this.date() + this.nth(Number(this.date()));
                    }
                };
            options.success(funcs);
            setTimeout(function () {
                getTimes();
            }, options.refresh);
        };
    getTimes();
}
(function wlib() {
    'use strict';
    var w = getWeather(),
        weather = {
            cvtF: function (temp) {
                return (temp == "--") ? this.temp() : Math.round(temp * 1.8 + 32);
            },
            cvtK: function (wind) {
                return Math.round(((wind * 1.609344) * 100) / 100);
            },
            cvtM: function (distance) {
                return Math.round(distance * 1.60934);
            },
            cvtS: function (time) {
                var timecut, timeE, cvtt;
                if (String(time).length > 3) {
                    timecut = String(time).slice(0, 2);
                    timeE = String(time).slice(2, 4);
                } else {
                    timeE = String(time).slice(1, 3);
                    timecut = String(time).slice(0, 1);
                }
                if (timecut === "00") {
                    return 12;
                }
                cvtt = (timecut > 12) ? timecut - 12 : timecut;
                return cvtt + ":" + timeE;
            },
            temp: function (deg) {
                return (celsius ? w.temperature : this.cvtF(w.temperature));
            },
            high: function (deg) {
                return (celsius ? w.dayForecasts[0].high + deg : this.cvtF(w.dayForecasts[0].high) + deg);
            },
            low: function (deg) {
                return (celsius ? w.dayForecasts[0].low + deg : this.cvtF(w.dayForecasts[0].low) + deg);
            },
            condition: function () {
                return translate[lang].condition[w.conditionCode];
            },
            icon: function () {
                return w.conditionCode;
            },
            city: function () {
                return w.name;
            },
            humidity: function () {
                return Math.round(w.humidity);
            },
            windchill: function (deg) {
                return Math.round(w.windChill) + deg;
            },
            wind: function (spd) {
                return (celsius ? this.cvtK(Math.round(w.windSpeed)) + spd : Math.round(w.windSpeed) + spd);
            },
            direction: function () {
                return windDirection();
            },
            visible: function (dis) {
                return (celsius ? this.cvtM(Math.round(w.visibility)) + dis : Math.round(w.visibility) + dis);
            },
            rain: function (perc) {
                var percent = (w.precipitationForecast === 2) ? 0 : w.precipitationForecast;
                return percent + perc;
            },
            dewpoint: function (deg) {
                return Math.round(w.dewPoint) + deg;
            },
            feelslike: function (deg) {
                return (celsius ? w.feelsLike + deg : this.cvtF(w.feelsLike) + deg);
            },
            sunset: function () {
                return (celsius ? w.sunsetTime : this.cvtS(w.sunsetTime));
            },
            sunrise: function () {
                return (celsius ? w.sunriseTime : this.cvtS(w.sunriseTime));
            },
            updated: function () {
                return w.updateTimeString;
            },
            start : function (weatherInterval) {
                var currentTime = new Date().getTime();
                if (currentTime > Number(localStorage.getItem('lastUpdate'))) {
                    weatherdivs();
                    updateWeather();
                    localStorage.setItem('lastUpdate', currentTime + weatherInterval);
                    setTimeout(function () {
                        wlib();
                        weatherdivs();
                    }, 2500);
                } else {
                    weatherdivs();
                }
                setTimeout(function () {
                    weather.start(weatherInterval);
                }, weatherInterval);
            }
        };
    window.weather = weather;
}());
function checkDiv(div) { //check if element is placed
    'use strict';
     var keys = Object.keys(action.savedElements.placedElements),
          loc = keys.indexOf(div);
     if (loc !== -1){
        return document.getElementById(keys[loc]);
     }
    return;
}
var weatherdivs = function () {//weather
    'use strict';
    var weatherArray = ['temp','tempdeg','tempdegplus','high','highdeg','highdegplus','low','lowdeg','lowdegplus','highdashlow','highslashlow','highdashlowdeg','highslashlowdeg','city','condition','humidity','windchill','wind','winddirection','visibility','rain','dewpoint','feelslike','feelslikedeg','sunrise','sunset','update','icon','tempcon','tempcon1','tempcon2','windstr'];

    var tcf = (celsius === true) ? 'c' : 'f';
    var spd = (celsius === true) ? 'kph' : 'mph';
    for (var i = 0; i < weatherArray.length; i++) {
        var div = checkDiv(weatherArray[i]);
        if (div) {
            var value;
            switch (div.id) {
              case 'tempcon':
                    value = weather.temp() + " " + weather.condition();
                    break;
              case 'tempcon1':
                    value = weather.temp() + "&deg;" + tcf + " " + weather.condition();
                    break;
              case 'tempcon2':
                    value = weather.temp() + "&deg; " + weather.condition();
                    break;
              case 'windstr':
                    value = weather.wind(spd) + " " + weather.direction();
                    break;
                case 'temp':
                    value = weather.temp();
                    break;
                case 'tempdeg':
                    value = weather.temp() + '&deg;';
                    break;
                case 'tempdegplus':
                    value = weather.temp() + '&deg;' + tcf;
                    break;
                case 'high':
                    value = weather.high('');
                    break;
                case 'highdeg':
                    value = weather.high('') + '&deg;';
                    break;
                case 'highdegplus':
                    value = weather.high('') + '&deg;' + tcf;
                    break;
                case 'low':
                    value = weather.low('');
                    break;
                case 'lowdeg':
                    value = weather.low('') + '&deg;';
                    break;
                case 'lowdegplus':
                    value = weather.low('') + '&deg;' + tcf;
                    break;
                case 'highdashlow':
                    value = weather.high('') + '-' + weather.low('');
                    break;
                case 'highslashlow':
                    value = weather.high('') + '/' + weather.low('');
                    break;
                case 'highdashlowdeg':
                    value = weather.high('') + '&deg;-' + weather.low('') + '&deg;';
                    break;
                case 'highslashlowdeg':
                    value = weather.high('') + '&deg;/' + weather.low('') + '&deg;';
                    break;
                case 'city':
                    value = weather.city();
                    break;
                case 'condition':
                    value = weather.condition();
                    break;
                case 'humidity':
                    value = weather.humidity();
                    break;
                case 'windchill':
                    value = weather.windchill('&deg');
                    break;
                case 'wind':
                    value = weather.wind(spd);
                    break;
                case 'winddirection':
                    value = weather.direction();
                    break;
                case 'visibility':
                    value = weather.visible(spd);
                    break;
                case 'rain':
                    value = weather.rain('%');
                    break;
                case 'dewpoint':
                    value = weather.dewpoint('&deg');
                    break;
                case 'feelslike':
                    value = weather.feelslike('');
                    break;
                case 'feelslikedeg':
                    value = weather.feelslike('&deg');
                    break;
                case 'sunrise':
                    value = weather.sunrise();
                    break;
                case 'sunset':
                    value = weather.sunset();
                    break;
                case 'update':
                    value = weather.updated();
                    break;
                case 'icon':
                    var icon = weather.icon();
                    value = icon;
                    break;
            }
            if (div.id === 'icon') {
                if(document.getElementById('iconDiv').src != 'http://junesiphone.com/weather/IconSets/' + action.savedElements.iconName + '/' + icon + '.png'){
                    document.getElementById('iconDiv').src = 'http://junesiphone.com/weather/IconSets/' + action.savedElements.iconName + '/' + icon + '.png';
                }
                //document.getElementById('iconDiv').src = 'http://junesiphone.com/weather/IconSets/' + action.savedElements.iconName + '/39.png';//testing
                //alert(action.savedElements.iconName + '/' + icon + '.png'); //testing
            } else {
                var prefix, suffix;
                if(div.getAttribute('data-prefix') !== null){
                  prefix = div.getAttribute('data-prefix');
                }else{
                  prefix = '';
                }
                if(div.getAttribute('data-suffix') !== null){
                  suffix = div.getAttribute('data-suffix');
                }else{
                  suffix = '';
                }
                div.innerHTML = prefix + value + suffix;
            }
        }
    }
};//end weather
function loadClock() { //clock
    clock({
        twentyfour: twentyfour,
        refresh: clockrefresh,
        success: function(clock) {
            'use strict';
            var clockArray = ['clock', 'zclock', 'clockline', 'clockpm', 'zhour', 'hour', 'minute', 'second', 'pm', 'tod', 'ttext', 'htext', 'mtext', 'date', 'prevdate', 'nextdate', 'dateplus', 'datetext', 'day', 'nextday', 'yestday', 'sday', 'snextday', 'sprevday', 'month', 'nextmonth', 'prevmonth', 'monthstring', 'datedotmonth', 'dateslashmonth', 'datemonth', 'smonth', 'snextmonth', 'sprevmonth', 'monthdot', 'monthline', 'mdy', 'datestring', 'datedash', 'year', 'datemonthrev', 'monthlinespace', 'daydate', 'datestringrev', 'datespace', 'daydotdate','hrmin','hrmintx','daydatemonth', 'daydatesmonth', 'daydatescommamonth', 'yeartext','hrnsmin', 'clocksmush', 'datebar', 'datesnslash', 'datesingled', 'hrsmush', 'dayabdatemonth', 'daycommadatemonth', 'datemonthfirst'];
            for (var i = 0; i < clockArray.length; i++) {
                var div = checkDiv(clockArray[i]);
                if (div) {
                    var value;
                    switch (div.id) {
                      case 'datemonthrev':
                            value = clock.monthtext() + " " + clock.date();
                            break;
                      case 'monthlinespace':
                            value = clock.monthtext() + " | " + clock.date() + " | " + clock.year();
                            break;
                      case 'daydate':
                            value = clock.daytext() + " " + clock.date();
                            break;
                      case 'datespace':
                            value = clock.daytext() + " " + clock.monthtext() + " " + clock.date();
                            break;
                      case 'daydotdate':
                            value = clock.daytext() + "." + clock.date();
                            break;
                       case 'datestringrev':
                            value = clock.monthtext() + " " + clock.date() + ", " + clock.daytext();
                            break;
                      case 'hrmintx':
                            value = (clock.minutetwotext() !== "") ? clock.hourtext() + '.' + clock.minuteonetextdot() +  '.' + clock.minutetwotext() : clock.hourtext() + '.' + clock.minuteonetextdot() + clock.minutetwotext();
                            break;
                      case 'hrmin':
                            value = clock.hourtext() + '.' + clock.minute();
                            break;
                      case 'daydatemonth':
                            value = clock.daytext() + " | " + clock.date() + " " + clock.monthtext();
                            break;
                        case 'clock':
                            value = clock.hour() + ":" + clock.minute();
                            break;
                        case 'zclock':
                            value = clock.zhour() + ":" + clock.minute();
                            break;
                        case 'clockline':
                            value = clock.hour() + "|" + clock.minute();
                            break;
                        case 'clockpm':
                            value = clock.hour() + ":" + clock.minute() + clock.am();
                            break;
                        case 'zhour':
                            value = clock.zhour();
                            break;
                        case 'hour':
                            value = clock.hour();
                            break;
                        case 'minute':
                            value = clock.minute();
                            break;
                        case 'second':
                            value = clock.second();
                            break;
                        case 'pm':
                            value = clock.am();
                            break;
                        case 'tod':
                            value = clock.tod();
                            break;
                        case 'ttext':
                            value = clock.hourtext() + " " + clock.minuteonetext() + ' ' + clock.minutetwotext();
                            break;
                        case 'htext':
                            value = clock.hourtext();
                            break;
                        case 'mtext':
                            value = clock.minuteonetext() + ' ' + clock.minutetwotext();
                            break;
                        case 'date':
                            value = clock.date();
                            break;
                        case 'prevdate':
                            value = clock.prevdate();
                            break;
                        case 'nextdate':
                            value = clock.nextdate();
                            break;
                        case 'dateplus':
                            value = clock.dateplus();
                            break;
                        case 'datetext':
                            value = clock.datetext();
                            break;
                        case 'day':
                            value = clock.daytext();
                            break;
                        case 'nextday':
                            value = clock.nextdaytext();
                            break;
                        case 'yestday':
                            value = clock.yesterdaydaytext();
                            break;
                        case 'sday':
                            value = clock.sdaytext();
                            break;
                        case 'snextday':
                            value = clock.snextday();
                            break;
                        case 'sprevday':
                            value = clock.sprevday();
                            break;
                        case 'month':
                            value = clock.monthtext();
                            break;
                        case 'nextmonth':
                            value = clock.nextmonthtext();
                            break;
                        case 'prevmonth':
                            value = clock.prevmonthtext();
                            break;
                        case 'monthstring':
                            value = clock.monthtext() + " the " + clock.dateplus();
                            break;
                        case 'datedotmonth':
                            value = clock.date() + '.' + clock.monthtext();
                            break;
                        case 'dateslashmonth':
                            value = clock.date() + "/" + clock.monthtext();
                            break;
                        case 'datemonth':
                            value = clock.date() + " " + clock.monthtext();
                            break;
                        case 'smonth':
                            value = clock.smonthtext();
                            break;
                        case 'snextmonth':
                            value = clock.snextmonth();
                            break;
                        case 'sprevmonth':
                            value = clock.sprevmonth();
                            break;
                        case 'monthdot':
                            value = clock.monthtext() + "." + clock.date();
                            break;
                        case 'monthline':
                            value = clock.monthtext() + "|" + clock.date() + "|" + clock.year();
                            break;
                        case 'mdy':
                            value = (clock.month() + 1) + "/" + clock.date() + "/" + clock.year();
                            break;
                        case 'datestring':
                            value = clock.daytext() + ", " + clock.monthtext() + " " + clock.date();
                            break;
                        case 'datedash':
                            value = clock.daytext() + "-" + clock.monthtext() + "-" + clock.date();
                            break;
                        case 'year':
                            value = clock.year();
                            break;
                        case 'daydatesmonth':
                            value = clock.daytext() + ' ' + clock.date() + ' ' + clock.smonthtext();
                            break;
                        case 'daydatescommamonth':
                            value = clock.daytext() + ', ' + clock.date() + ' ' + clock.smonthtext();
                            break;
                        case 'yeartext':
                            value = convertTOWord(clock.year());
                            break;
                        case 'datebar':
                            value = clock.month() + '|' + clock.date() + '|' + clock.smyear();
                            break;
                        case 'datesnslash':
                            value = clock.month() + '/' + clock.date() + '/' + clock.smyear();
                            break;
                        case 'datesingled':
                            value = clock.month() + '-' + clock.date() + '-' + clock.smyear();
                            break;
                        case 'hrsmush':
                            value = clock.hourtext() + '' + clock.minute();
                            break;
                        case 'dayabdatemonth':
                            value = clock.sdaytext() + ' ' + clock.date() + ' ' + clock.smonthtext();
                            break;
                        case 'daycommadatemonth':
                            value = clock.sdaytext() + ', ' + clock.date() + ' ' + clock.smonthtext();
                            break;
                        case 'hrnsmin':
                            value = clock.hourtext() + ' ' + clock.minute();
                            break;
                        case 'clocksmush':
                            value = clock.hour() + "" + clock.minute();
                            break;
                        case 'datemonthfirst':
                            value = clock.date() + ' ' + clock.monthtext();
                            break;


                    }
                      var prefix, suffix;
                      if(div.getAttribute('data-prefix') !== null){
                        prefix = div.getAttribute('data-prefix');
                      }else{
                        prefix = '';
                      }
                      if(div.getAttribute('data-suffix') !== null){
                        suffix = div.getAttribute('data-suffix');
                      }else{
                        suffix = '';
                      }
                      div.innerHTML = prefix + value + suffix;

                }
            };
        }
    });
} //end clock

var systemdivs = function() { //system
    'use strict';
    var sysArray = ['name', 'firmware', 'battery', 'batterypercent', 'chargingtxt', 'chargingstate', 'unlock', 'signal', 'signalpercent', 'alarm24', 'alarm', 'alarmpm', 'wifi', 'wifipercent', 'notifymail', 'notifysms', 'notifyphone', 'notifywhats', 'notifytelegram'];
    var signalArray = ["0%","20%","40%","60%","80%","100%"];
    for (var i = 0; i < sysArray.length; i++) {
        var div = checkDiv(sysArray[i]);
        if (div) {
            var value;
            switch (div.id) {
                case 'name':
                    value = deviceName();
                    break;
                case 'firmware':
                    value = firmwareType();
                    break;
                case 'battery':
                    value = batteryPercent();
                    break;
                case 'batterypercent':
                    value = batteryPercent() + "%";
                    break;
                case 'chargingtxt':
                    value = getCharging();
                    break;
                case 'chargingstate':
                    value = getisCharging();
                    break;
                case 'unlock':
                    value = "Unlock";
                    break;
                case 'signal':
                    value = getSignal();
                    break;
                case 'signalpercent':
                    value = signalArray[getSignal()];
                    break;
                case 'alarm24':
                    value = getAlarm();
                    break;
                case 'alarm':
                    value = getAlarm('12');
                    break;
                case 'alarmpm':
                    value = getAlarm('12',true);
                    break;
                case 'wifi':
                    value = Math.round(getWifi()*100);
                    break;
                case 'wifipercent':
                    value = Math.round(getWifi()*100)+"%";
                    break;
                case 'notifymail':
                    value = getNotifications('com.apple.mobilemail');
                    break;
                case 'notifysms':
                    value = getNotifications('com.apple.MobileSMS');
                    break;
                case 'notifyphone':
                    value = getNotifications('com.apple.mobilephone');
                    break;
                case 'notifywhats':
                    value = getNotifications('net.whatsapp.WhatsApp');
                    break;
                case 'notifytelegram':
                    value = getNotifications('ph.telegra.Telegraph');
                    break;
            }
            var prefix, suffix;
            if(div.getAttribute('data-prefix') !== null){
              prefix = div.getAttribute('data-prefix');
            }else{
              prefix = '';
            }
            if(div.getAttribute('data-suffix') !== null){
              suffix = div.getAttribute('data-suffix');
            }else{
              suffix = '';
            }
            div.innerHTML = prefix + value + suffix;

        }
    }
}; // end system
var miscDivs = function() { //misc
    'use strict';
    var miscArray = ['textOne', 'textTwo', 'textThree', 'textFour', 'textFive', 'app1', 'app2', 'app3', 'app4', 'app5', 'app6', 'app7', 'app8', 'app9', 'app10', 'app11', 'app12', 'app13', 'app14', 'app15', 'app16', 'app17', 'app18', 'app19', 'app20', 'app21', 'app21', 'app22', 'app23', 'app24', 'app25', 'app26', 'app27', 'app28', 'app29'];
    for (var i = 0; i < miscArray.length; i++) {
        var div = checkDiv(miscArray[i]);
        if (div) {
            var value;
            switch (div.id) {
                case 'textOne':
                    value = "Text";
                    break;
                case 'textTwo':
                    value = "Text";
                    break;
                case 'textThree':
                    value = 'Text';
                    break;
                case 'textFour':
                    value = 'Text';
                    break;
                case 'textFive':
                    value = 'Text';
                    break;
                case 'app1':
                    value = 'Mail-com.apple.mobilemail';
                    break;
                case 'app2':
                    value = 'SMS-com.apple.MobileSMS';
                    break;
                case 'app3':
                    value = 'Phone-com.apple.mobilephone';
                    break;
                case 'app4':
                    value = 'Twitter-com.atebits.Tweetie2';
                    break;
                case 'app5':
                    value = 'Tweetbot3-com.tapbots.Tweetbot3';
                    break;
                case 'app6':
                    value = 'Telegram-ph.telegra.Telegraph';
                    break;
                case 'app7':
                    value = 'Instagram-com.burbn.instagram';
                    break;
                case 'app8':
                    value = 'Pandora-com.pandora';
                    break;
                case 'app9':
                    value = 'Spotify-com.spotify.client';
                    break;
                case 'app10':
                    value = 'Facebook-com.facebook.Facebook';
                    break;
                case 'app11':
                    value = 'Kik-com.kik.chat';
                    break;
                case 'app12':
                    value = 'YouTube-com.google.ios.youtube';
                    break;
                case 'app13':
                    value = 'WhatsApp-net.whatsapp.WhatsApp';
                    break;
                case 'app14':
                    value = 'Safari-com.apple.mobilesafari';
                    break;
                case 'app15':
                    value = 'Weather-com.apple.weather';
                    break;
                case 'app16':
                    value = 'Clock-com.apple.mobiletimer';
                    break;
                case 'app17':
                    value = 'Music-com.apple.Music';
                    break;
                case 'app18':
                    value = 'Camera-com.apple.camera';
                    break;
                case 'app19':
                    value = 'Reminders-com.apple.reminders';
                    break;
                case 'app20':
                    value = 'Notes-com.apple.mobilenotes';
                    break;
                case 'app21':
                    value = 'Maps-com.apple.Maps';
                    break;
                case 'app22':
                    value = 'Calendar-com.apple.mobilecal';
                    break;
                case 'app23':
                    value = 'Calculator-com.apple.calculator';
                    break;
                case 'app24':
                    value = 'Cydia-com.saurik.Cydia';
                    break;
                case 'app25':
                    value = 'YouTube-com.google.ios.youtube';
                    break;
                case 'app26':
                    value = 'Settings-com.apple.Preferences';
                    break;
                case 'app27':
                    value = 'AppStore-com.apple.AppStore';
                    break;
                case 'app28':
                    value = 'Health-com.apple.Health';
                    break;
            }
            if(div.id.substring(0,3) === 'app'){
              div.innerHTML = value.split('-')[0];
              div.setAttribute('data-target',value.split('-')[1]);
            }else{
              if (div.innerHTML === '') {
                div.innerHTML = value;
              }
            }
        }
    }
};//end misc
var action = { //actions
    themeList: [],
    themePosition: 0,
    savedElements: {},
    loadedFonts: [],
    settingIcons : ['load', 'reset', 'refresh', 'settings', 'download'],
    showLoader: function(state){
      if(state){
        document.getElementById('loaderGif').style.display = 'block';
      }else{
        document.getElementById('loaderGif').style.display = "none";
      }
    },
    toggleMenu: function (state) {
        var sOffset;
        switch (state) {
        case 'open':
            sOffset = 'block';
            break;
        case 'close':
            sOffset = 'none';
            break;
        }
        document.querySelector('.menuScreen').style.display = sOffset;
    },
    menuClick: function (id) {
        switch (id) {
        case 'load':
            this.populateThemeList();
            break;
        case 'reset':
            localStorage.removeItem('placedElements');
            location.reload();
            break;
        case 'refresh':
            updateWeather();
            action.toggleMenu('close');
            setTimeout(function () { location.reload(); }, 1000);
            break;
        case 'settings':
            openURL('prefs:root=LockPlus');
            break;
        case 'view':
        action.toggleMenu('close');
        //action.showLoader(true);
        loadJS();
            //openURL('http://lockplus.info/themes');
            break;
        case 'download':
            var prmp = window.prompt("Enter the name of your theme.", '');
            if(prmp.length != 0){
              document.getElementById('frame').style.display = 'block';
              action.showLoader(true);
              setTimeout(function(){saveURL(prmp);},300);
            }else{
              alert('You must enter a name');
            }
            break;
        }
    },
    populateThemeList: function () {

        folderExists('LockPlus');
        var folderContents = readFolder('var/mobile/Library/LockPlus'),
            i;
        if (folderContents.length <= 0) {
            window.alert('You have no themes saved:(');
        } else {
            for (i = 0; i < folderContents.length; i += 1) {
              if (folderContents[i].substring(folderContents[i].length - 6, folderContents[i].length) === '.plist'){
                action.themeList.push(String(folderContents[i]));
              }
            }
            this.displayThemeList();
            if(!jsSwipes.swipeEnabled){
              detectswipe('.themeList', jsSwipes.switchThemes);
              jsSwipes.swipeEnabled = true;
            }
        }
    },
    displayThemeList: function () {
        this.toggleMenu('close');
        var dict = readDict('var/mobile/Library/LockPlus/' + this.themeList[this.themePosition]),
            tPrev = dict.ThemePreview,
            tName = dict.ThemeName,
            cName = dict.DevName;
            var favName = String(action.themeList[action.themePosition]);
            var Apos = themeFav.indexOf(favName);
            if(Apos === -1){
              document.getElementById('favorite').style.opacity = "0.2";
            }else{
              document.getElementById('favorite').style.opacity = "1";
            }
        document.querySelector('.themeList').style.backgroundImage = 'url(' + tPrev + ')';
        document.querySelector('.themeName').innerHTML = tName + ' by: ' + cName;
        document.querySelector('.themeList').style.display = 'block';
        document.querySelector('.darkbg').style.display = 'block';
        document.querySelector('.themeCount').innerHTML = (this.themePosition + 1) + '/' + this.themeList.length;
        document.getElementById('trash').style.display = 'block';
        document.getElementById('favorite').style.display = 'block';
        dict = null;
    },
    saveTheme: function () {
        try {
            var dict = readDict('var/mobile/Library/LockPlus/' + this.themeList[this.themePosition]);
            if (dict.Wallpaper.length > 10) {
              if(!nowall){
                setLSWall(dict.Wallpaper);
                if(sbwall){
                  setSBWall(dict.Wallpaper);
                }
              }
            }
            action.savedElements.overlay = dict.Overlay;
            if (dict.Elements.length > 10) {
                action.savedElements.placedElements = JSON.parse(dict.Elements);
            } else {
                action.savedElements.placedElements = '';
            }
            if (dict.IconName.length > 2) {
                action.savedElements.iconName = dict.IconName;
            } else {
                action.savedElements.iconName = 'simply';
            }
            localStorage.setItem('placedElements', JSON.stringify(action.savedElements));
            dict = null;
            window.location = location.href;
        } catch (err) { // if theme doesn't exist that means its in favorites. Lets remove it.
          var Adeleted = themeFav.indexOf(this.themeList[this.themePosition]);
              if(Adeleted !== -1){
                  themeFav.splice(Adeleted,1);
                  alert('Theme ' + this.themeList[this.themePosition] + ' is in your favorites, but is not on your device. We will remove it from your favorites.');
                  localStorage.themeFav = JSON.stringify(themeFav);
              }
            //window.alert(err);
        }
    },
    loadTheme:function(name){
      var dict = readDict('var/mobile/Library/LockPlus/' + name + '.plist');
            if (dict.Wallpaper.length > 10) {
              if(!nowall){
                setLSWall(dict.Wallpaper);
                if(sbwall){
                  setSBWall(dict.Wallpaper);
                }
              }
            }
            action.savedElements.overlay = dict.Overlay;
            if (dict.Elements.length > 10) {
                action.savedElements.placedElements = JSON.parse(dict.Elements);
            } else {
                action.savedElements.placedElements = '';
            }
            if (dict.IconName.length > 2) {
                action.savedElements.iconName = dict.IconName;
            } else {
                action.savedElements.iconName = 'simply';
            }
            localStorage.setItem('placedElements', JSON.stringify(action.savedElements));
            dict = null;
            window.location = location.href;
    },
    setOverlay: function (img) { //apply overlay to screenoverlay
        document.querySelector('.screenoverlay').style.backgroundImage = 'url(' + img + ')';
        document.querySelector('.svg').src = img;
        showSVG('.svg', true);
    },
    remakeDIV: function (id) {
        var div = document.createElement('div');
        div.id = id;
        if (id !== 'icon' && id !== 'unlock' && id.substring(0, 4) !== 'text' && id.substring(0, 3) !== 'box' && id.substring(0, 3) !== 'app') {
            div.innerHTML = "*"; //preload font
            div.style.pointerEvents = "none";
        }
        document.getElementById('screenElements').appendChild(div);
    },
    injectFont: function(){
      var css = "";
      for (var i = 0; i < action.loadedFonts.length; i++) {
        css +=  "\n@font-face{\nfont-family:'"+action.loadedFonts[i]+"';\nsrc:url('user/"+action.loadedFonts[i]+".otf');\n}"
      }
      var head = document.head || document.getElementsByTagName('head')[0],
          style = document.createElement('style');
      style.type = 'text/css';
      if (style.styleSheet) {
          style.styleSheet.cssText = css;
      } else {
          style.appendChild(document.createTextNode(css));
      }
      head.appendChild(style);
      //puts(document.head.innerHTML);

    },
    stageFont: function(font){
      if (action.loadedFonts.indexOf(font) === -1){
        action.loadedFonts.push(font);
      }
    },
    replaceElements: function () {
        Object.keys(this.savedElements.placedElements).forEach(function (key) {
            action.remakeDIV(key); //loop object and place items
            var value = action.savedElements.placedElements[key];
            if(key === 'icon'){
              img = document.createElement('img');
                    img.className = 'icon';
                    img.id = 'iconDiv';
                    document.getElementById('icon').appendChild(img);
            }
            Object.keys(value).forEach(function (skey) { //loop styles on the object
                var styleVal = value[skey],
                    img;
                    if(skey === 'data-prefix' || skey === 'data-suffix'){
                      if(skey === 'data-prefix'){
                        document.getElementById(key).setAttribute('data-prefix',styleVal);
                      }
                      if(skey === 'data-suffix'){
                        document.getElementById(key).setAttribute('data-suffix',styleVal);
                      }
                    }else{
                      document.getElementById(key).style.cssText += skey + ":" + styleVal;
                    }
                if(skey === 'font-family'){
                  action.stageFont(styleVal);
                }
                if (key === 'icon') { //resize img inside #icon
                  document.getElementById('icon').style.cssText += skey + ":" + styleVal; //icon container div
                  if(skey !== 'position' && skey !== 'font-family'){
                     if(skey === 'width' || skey === 'height'){
                      document.querySelector('.icon').style.cssText += skey + ":" + styleVal; //icon image
                     }
                     //document.querySelector('.icon').style.outline = "1px solid teal"; //testing
                     //alert(document.body.outerHTML);
                     //alert(skey + ":" + styleVal);
                  }
                } else if (key.substring(0, 4) === 'text' && skey === 'innerHTML') {
                    document.getElementById(key).innerHTML = styleVal;
                }
            });
        });
        loadClock();
        systemdivs();
        miscDivs();
        if(!disableweather){
          try{
            weather.start(weatherrefresh);
          }catch(ignore){}
        }
        action.injectFont();
        //alert(document.head.innerHTML)
        action.savedElements.overlay = null;
        //action.savedElements = {}; //clear this object, as it contains alot of code. (Wallpaper and overlay)
    },
    loadFromStorage: function () { //reload elements onload
        if (localStorage.placedElements) {
            this.savedElements = JSON.parse(localStorage.placedElements);
            if (this.savedElements.overlay) { //set overlay
              if(!nooverlay){
                this.setOverlay(this.savedElements.overlay);
              }
            }
            if (this.savedElements.placedElements) {
                this.replaceElements(); //put items back on screen
            }
        }else{
          setTimeout(function(){
            showSVG('.download', true);
          },100);
        }
    },
};//end actions

window.onload = function () {
    action.loadFromStorage();
};


document.querySelector('.menuScreen').addEventListener('touchstart', function (el) {
  if(el.target.id !== 'settings' && el.target.id !=='view'){
    action.menuClick(el.target.id);
  }
    el.preventDefault();
});
document.querySelector('.menuScreen').addEventListener('touchend',function (el){
  if(el.target.id === 'settings' || el.target.id === 'view'){
    action.menuClick(el.target.id);
  }
});

document.getElementById('screenElements').addEventListener('touchend', function (el) {
  if(el.target.id.substring(0,3) === 'app'){
    openApp(document.getElementById(el.target.id).getAttribute('data-target'));
  }else if (el.target.id === 'unlock') {
      unlockPhone();
  }
});
if(!disablemenu){
  detectswipe('.detectSwipe', jsSwipes.detectswipe);
}
(function () {
    if (window.innerWidth === 375) {
        document.querySelector("meta[name=viewport]").setAttribute('content', 'width=device-width, initial-scale=1.18, maximum-scale=1.18, user-scalable=0');
    } else if (window.innerWidth === 414) {
        document.querySelector("meta[name=viewport]").setAttribute('content', 'width=device-width, initial-scale=1.3, maximum-scale=1.3, user-scalable=0');
    }
}());
(function() { //svg parsing
    "use strict";
    var desvg = function(selector, removeInlineCss) {
        removeInlineCss = removeInlineCss || false;
        var images,
            imagesLength,
            sortImages = {},
            loadSvg = function (imgURL, replaceImages) {
                var xhr = new XMLHttpRequest();
                xhr.open('GET', imgURL, true);
                xhr.onload = function() {
                    var xml,
                        svg,
                        paths,
                        replaceImagesLength;
                    xml = xhr.responseXML;
                    replaceImagesLength = replaceImages.length;
                    if (!xml) {
                        return;
                    }
                    svg = xml.documentElement;
                    paths = svg.querySelectorAll('path');
                    if (removeInlineCss) {
                        for (var i = 0; i < paths.length; i++) {
                            paths[i].removeAttribute('style');
                        }
                    }
                    svg.removeAttribute('xmlns:a');
                    while(replaceImagesLength--) {
                        replaceImgWithSvg(replaceImages[replaceImagesLength], svg.cloneNode(true));
                    }
                };
                xhr.send();
            },
            replaceImgWithSvg = function (img, svg) {
                var imgID = img.id,
                    imgClasses = img.getAttribute('class');
                if (imgID) {
                    svg.id = imgID;
                }
                if (imgClasses) {
                    svg.setAttribute('class', imgClasses + ' replaced-svg');
                }
                img.parentNode.replaceChild(svg, img);
            };
        images = document.querySelectorAll(selector);
        imagesLength = images.length;
        while (imagesLength--) {
            var _img = images[imagesLength],
                _imgURL = _img.getAttribute('src');
            if(sortImages[_imgURL]) {
                sortImages[_imgURL].push(_img);
            } else {
                sortImages[_imgURL] = [_img];
            }
        }
        for (var key in sortImages) {
            if (sortImages.hasOwnProperty(key)) {
                loadSvg(key, sortImages[key]);
            }
        }
    };
    window.showSVG = desvg;
})();

if(wantsAnimatedWeather){
   var head= document.getElementsByTagName('head')[0];
   var script= document.createElement('script');
   script.type= 'text/javascript';
   script.src= 'animation/animation.js';
   head.appendChild(script);
}

if(wantsAnimatedBirds){
  var iframe = document.createElement('iframe');
  iframe.frameBorder=0;
  iframe.width="320px";
  iframe.height="568px";
  iframe.id="birds";
  iframe.setAttribute("src", "animation/index.html");
  document.body.appendChild(iframe);
}
//localStorage.clear();
//localStorage.badges = 0;
</script>

</body>
</html>